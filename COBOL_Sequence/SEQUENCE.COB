       IDENTIFICATION DIVISION.
       PROGRAM-ID. THE-SEQUENCE.
       AUTHOR. THE MANDATE.
       DATE-WRITTEN. 2025-07-30.
      * 
      * THE SEQUENCE - COBOL IMPLEMENTATION
      * A MONUMENT TO ORDINAL PROGRESSION
      * 
       
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CONSOLE IS CRT
           CRT STATUS IS KEYSTROKE-STATUS.
       
       DATA DIVISION.
       WORKING-STORAGE SECTION.
       
      * ORDINAL REPRESENTATION
       01 ORDINAL-TERMS.
           05 TERM-ENTRY OCCURS 32 TIMES INDEXED BY TERM-IDX.
               10 TERM-EXPONENT     PIC S9(4) COMP VALUE ZERO.
               10 TERM-COEFFICIENT  PIC S9(9) COMP VALUE ZERO.
       
       01 SEQUENCE-CONTROL.
           05 STEP-COUNT           PIC S9(18) COMP VALUE ZERO.
           05 TERM-COUNT           PIC S9(4) COMP VALUE ZERO.
           05 RUNNING-FLAG         PIC X VALUE 'Y'.
           05 PI-VALUE            PIC S9(18)V9(18) COMP-3
                                  VALUE 3.141592653589793238.
       
       01 DISPLAY-VARS.
           05 ORDINAL-STRING       PIC X(200) VALUE SPACES.
           05 ORDINAL-LENGTH       PIC S9(4) COMP VALUE ZERO.
           05 SCREEN-ROW           PIC S9(4) COMP VALUE 12.
           05 SCREEN-COL           PIC S9(4) COMP VALUE 40.
       
       01 TIMING-VARS.
           05 START-TIME           PIC S9(18) COMP-3.
           05 CURRENT-TIME         PIC S9(18) COMP-3.
           05 ELAPSED-TIME         PIC S9(18) COMP-3.
           05 PI-SECONDS           PIC S9(18) COMP-3.
       
       01 WORK-VARS.
           05 TEMP-NUMBER          PIC S9(9) COMP.
           05 TEMP-STRING          PIC X(20).
           05 KEYSTROKE-STATUS     PIC X.
           05 WORK-REMAINDER       PIC S9(9) COMP.
           05 WORK-OFFSET          PIC S9(9) COMP.
       
       SCREEN SECTION.
       01 BLANK-SCREEN.
           05 BLANK-LINE OCCURS 25 TIMES.
               10 LINE + 1 COL 1 PIC X(80) VALUE ALL SPACES
                  BACKGROUND-COLOR 0 FOREGROUND-COLOR 7.
       
       01 ORDINAL-DISPLAY.
           05 LINE 12 COL 1 PIC X(80) VALUE SPACES
              BACKGROUND-COLOR 0 FOREGROUND-COLOR 7.
       
       PROCEDURE DIVISION.
       MAIN-PROGRAM.
           PERFORM INITIALIZE-SEQUENCE
           PERFORM MAIN-LOOP UNTIL RUNNING-FLAG = 'N'
           PERFORM CLEANUP-SEQUENCE
           STOP RUN.
       
       INITIALIZE-SEQUENCE.
           DISPLAY BLANK-SCREEN
           MOVE ZERO TO STEP-COUNT
           MOVE ZERO TO TERM-COUNT
           MOVE 'Y' TO RUNNING-FLAG
           COMPUTE PI-SECONDS = PI-VALUE * 1000000.
       
       MAIN-LOOP.
           PERFORM UPDATE-ORDINAL
           PERFORM DISPLAY-ORDINAL
           PERFORM WAIT-PI-SECONDS
           PERFORM CHECK-TERMINATION.
       
       UPDATE-ORDINAL.
           ADD 1 TO STEP-COUNT
           
      * CLEAR CURRENT TERMS
           PERFORM VARYING TERM-IDX FROM 1 BY 1 UNTIL TERM-IDX > 32
               MOVE ZERO TO TERM-EXPONENT(TERM-IDX)
               MOVE ZERO TO TERM-COEFFICIENT(TERM-IDX)
           END-PERFORM
           MOVE ZERO TO TERM-COUNT
           
      * GENERATE NEXT ORDINAL BASED ON STEP COUNT
           EVALUATE TRUE
               WHEN STEP-COUNT < 1000
                   PERFORM HANDLE-NATURAL-NUMBERS
               WHEN STEP-COUNT = 1000
                   PERFORM HANDLE-FIRST-OMEGA
               WHEN STEP-COUNT < 2000
                   PERFORM HANDLE-OMEGA-PLUS-N
               WHEN STEP-COUNT = 2000
                   PERFORM HANDLE-OMEGA-TIMES-TWO
               WHEN STEP-COUNT < 3000
                   PERFORM HANDLE-OMEGA-TIMES-TWO-PLUS-N
               WHEN STEP-COUNT = 3000
                   PERFORM HANDLE-OMEGA-SQUARED
               WHEN OTHER
                   PERFORM HANDLE-HIGHER-ORDINALS
           END-EVALUATE.
       
       HANDLE-NATURAL-NUMBERS.
           IF STEP-COUNT > ZERO
               MOVE ZERO TO TERM-EXPONENT(1)
               MOVE STEP-COUNT TO TERM-COEFFICIENT(1)
               MOVE 1 TO TERM-COUNT
           END-IF.
       
       HANDLE-FIRST-OMEGA.
           MOVE 1 TO TERM-EXPONENT(1)
           MOVE 1 TO TERM-COEFFICIENT(1)
           MOVE 1 TO TERM-COUNT.
       
       HANDLE-OMEGA-PLUS-N.
           COMPUTE WORK-OFFSET = STEP-COUNT - 1000
           MOVE 1 TO TERM-EXPONENT(1)
           MOVE 1 TO TERM-COEFFICIENT(1)
           MOVE 1 TO TERM-COUNT
           IF WORK-OFFSET > ZERO
               MOVE ZERO TO TERM-EXPONENT(2)
               MOVE WORK-OFFSET TO TERM-COEFFICIENT(2)
               MOVE 2 TO TERM-COUNT
           END-IF.
       
       HANDLE-OMEGA-TIMES-TWO.
           MOVE 1 TO TERM-EXPONENT(1)
           MOVE 2 TO TERM-COEFFICIENT(1)
           MOVE 1 TO TERM-COUNT.
       
       HANDLE-OMEGA-TIMES-TWO-PLUS-N.
           COMPUTE WORK-OFFSET = STEP-COUNT - 2000
           MOVE 1 TO TERM-EXPONENT(1)
           MOVE 2 TO TERM-COEFFICIENT(1)
           MOVE 1 TO TERM-COUNT
           IF WORK-OFFSET > ZERO
               MOVE ZERO TO TERM-EXPONENT(2)
               MOVE WORK-OFFSET TO TERM-COEFFICIENT(2)
               MOVE 2 TO TERM-COUNT
           END-IF.
       
       HANDLE-OMEGA-SQUARED.
           MOVE 2 TO TERM-EXPONENT(1)
           MOVE 1 TO TERM-COEFFICIENT(1)
           MOVE 1 TO TERM-COUNT.
       
       HANDLE-HIGHER-ORDINALS.
           COMPUTE TEMP-NUMBER = (STEP-COUNT - 3000) / 1000
           COMPUTE TEMP-NUMBER = TEMP-NUMBER + 2
           MOVE TEMP-NUMBER TO TERM-EXPONENT(1)
           MOVE 1 TO TERM-COEFFICIENT(1)
           COMPUTE WORK-REMAINDER = FUNCTION MOD(STEP-COUNT - 3000, 1000)
           MOVE 1 TO TERM-COUNT
           IF WORK-REMAINDER > ZERO
               MOVE ZERO TO TERM-EXPONENT(2)
               MOVE WORK-REMAINDER TO TERM-COEFFICIENT(2)
               MOVE 2 TO TERM-COUNT
           END-IF.
       
       DISPLAY-ORDINAL.
           MOVE SPACES TO ORDINAL-STRING
           MOVE ZERO TO ORDINAL-LENGTH
           
           IF TERM-COUNT = ZERO
               MOVE "0" TO ORDINAL-STRING
               MOVE 1 TO ORDINAL-LENGTH
           ELSE
               PERFORM BUILD-ORDINAL-STRING
           END-IF
           
           PERFORM CENTER-AND-DISPLAY.
       
       BUILD-ORDINAL-STRING.
           PERFORM VARYING TERM-IDX FROM 1 BY 1 UNTIL TERM-IDX > TERM-COUNT
               IF TERM-IDX > 1
                   PERFORM APPEND-PLUS-SIGN
               END-IF
               PERFORM BUILD-TERM-STRING
           END-PERFORM.
       
       BUILD-TERM-STRING.
           MOVE TERM-EXPONENT(TERM-IDX) TO TEMP-NUMBER
           EVALUATE TEMP-NUMBER
               WHEN ZERO
                   PERFORM BUILD-CONSTANT-TERM
               WHEN 1
                   PERFORM BUILD-OMEGA-TERM
               WHEN 2
                   PERFORM BUILD-OMEGA-SQUARED-TERM
               WHEN OTHER
                   PERFORM BUILD-OMEGA-POWER-TERM
           END-EVALUATE.
       
       BUILD-CONSTANT-TERM.
           MOVE TERM-COEFFICIENT(TERM-IDX) TO TEMP-NUMBER
           IF TEMP-NUMBER = 1 AND TERM-IDX > 1
               PERFORM APPEND-TO-STRING WITH "1"
           ELSE
               MOVE TEMP-NUMBER TO TEMP-STRING
               PERFORM APPEND-TO-STRING WITH TEMP-STRING
           END-IF.
       
       BUILD-OMEGA-TERM.
           MOVE TERM-COEFFICIENT(TERM-IDX) TO TEMP-NUMBER
           IF TEMP-NUMBER = 1
               PERFORM APPEND-TO-STRING WITH "ω"
           ELSE
               PERFORM APPEND-TO-STRING WITH "ω⋅"
               MOVE TEMP-NUMBER TO TEMP-STRING
               PERFORM APPEND-TO-STRING WITH TEMP-STRING
           END-IF.
       
       BUILD-OMEGA-SQUARED-TERM.
           MOVE TERM-COEFFICIENT(TERM-IDX) TO TEMP-NUMBER
           IF TEMP-NUMBER = 1
               PERFORM APPEND-TO-STRING WITH "ω²"
           ELSE
               PERFORM APPEND-TO-STRING WITH "ω²⋅"
               MOVE TEMP-NUMBER TO TEMP-STRING
               PERFORM APPEND-TO-STRING WITH TEMP-STRING
           END-IF.
       
       BUILD-OMEGA-POWER-TERM.
           MOVE TERM-COEFFICIENT(TERM-IDX) TO TEMP-NUMBER
           IF TEMP-NUMBER = 1
               PERFORM APPEND-TO-STRING WITH "ω^"
               MOVE TERM-EXPONENT(TERM-IDX) TO TEMP-STRING
               PERFORM APPEND-TO-STRING WITH TEMP-STRING
           ELSE
               PERFORM APPEND-TO-STRING WITH "ω^"
               MOVE TERM-EXPONENT(TERM-IDX) TO TEMP-STRING
               PERFORM APPEND-TO-STRING WITH TEMP-STRING
               PERFORM APPEND-TO-STRING WITH "⋅"
               MOVE TERM-COEFFICIENT(TERM-IDX) TO TEMP-STRING
               PERFORM APPEND-TO-STRING WITH TEMP-STRING
           END-IF.
       
       APPEND-PLUS-SIGN.
           PERFORM APPEND-TO-STRING WITH "+".
       
       APPEND-TO-STRING.
           LINKAGE SECTION.
           01 APPEND-TEXT          PIC X(20).
           PROCEDURE DIVISION USING APPEND-TEXT.
           STRING ORDINAL-STRING DELIMITED BY SPACE
                  APPEND-TEXT DELIMITED BY SPACE
                  INTO ORDINAL-STRING
           END-STRING
           COMPUTE ORDINAL-LENGTH = FUNCTION LENGTH(
               FUNCTION TRIM(ORDINAL-STRING)).
       
       CENTER-AND-DISPLAY.
           DISPLAY BLANK-SCREEN
           COMPUTE SCREEN-COL = (80 - ORDINAL-LENGTH) / 2 + 1
           DISPLAY ORDINAL-STRING(1:ORDINAL-LENGTH) 
               AT LINE 12 COL SCREEN-COL
               WITH BACKGROUND-COLOR 0 FOREGROUND-COLOR 7.
       
       WAIT-PI-SECONDS.
           ACCEPT START-TIME FROM TIME
           COMPUTE CURRENT-TIME = START-TIME
           PERFORM UNTIL ELAPSED-TIME >= PI-SECONDS
               ACCEPT CURRENT-TIME FROM TIME
               IF CURRENT-TIME < START-TIME
                   COMPUTE ELAPSED-TIME = (86400000000 - START-TIME) 
                                        + CURRENT-TIME
               ELSE
                   COMPUTE ELAPSED-TIME = CURRENT-TIME - START-TIME
               END-IF
           END-PERFORM.
       
       CHECK-TERMINATION.
           ACCEPT KEYSTROKE-STATUS FROM ESCAPE KEY
           IF KEYSTROKE-STATUS NOT = SPACE
               MOVE 'N' TO RUNNING-FLAG
           END-IF.
       
       CLEANUP-SEQUENCE.
           DISPLAY BLANK-SCREEN.
       
       END PROGRAM THE-SEQUENCE.